name: Update TryHackMe Badge

permissions:
  contents: write

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  update-badge:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0
      - name: Fetch TryHackMe Badge
        uses: DhanushNehru/tryhackme-badge-action-workflow@v1.1
        with:
          username: djmahe4
          user_id: 1979327  # e.g., 1234567
          image_path: './thm_propic.png'  # or tryhackme-badge.png
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
        continue-on-error: true
      - name: Commit and push badge if changed
        env:
          COMMIT_MESSAGE: "Updated THM profile badge"
        run: |
          git add ./assets/tryhackme-badge.png || true
  
          # If there are no staged changes, exit successfully
          if git diff --cached --quiet; then
            echo "No changes to commit"
            exit 0
          fi

          git commit -m "$COMMIT_MESSAGE"

          # Push current HEAD back to the branch that triggered the workflow
          git push origin "HEAD:${{ github.ref_name }}"
